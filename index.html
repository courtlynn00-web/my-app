<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mystery Mood ‚Äî Tracker</title>
<link rel="manifest" href="manifest.json">
<style>
  :root{
    --peach:#FAD7C8;
    --peach-light:#FDEDE5;
    --brown:#6A4A3C;
    --accent:#F8B9C4;
    --white:#ffffff;
  }
  *{box-sizing:border-box;font-family:-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  body{margin:0;background:linear-gradient(180deg,var(--peach-light),#fff);color:var(--brown);padding:24px;display:flex;justify-content:center}
  .wrap{max-width:780px;width:100%}
  header{text-align:center;margin-bottom:14px}
  header h1{margin:6px 0;font-size:28px}
  .card{background:var(--white);border-radius:18px;padding:16px;margin:12px 0;box-shadow:0 8px 22px rgba(0,0,0,0.06)}
  .mood-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:8px}
  .mood-btn{padding:10px 14px;border-radius:12px;border:none;background:linear-gradient(180deg,var(--peach),var(--accent));color:var(--white);font-weight:600;cursor:pointer;box-shadow:0 6px 12px rgba(0,0,0,0.06)}
  .mood-small{padding:8px 10px;border-radius:10px;border:2px solid var(--peach);background:white;color:var(--brown);cursor:pointer}
  #result{font-size:20px;margin-top:12px;text-align:center}
  .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
  textarea{width:100%;min-height:64px;border-radius:10px;padding:10px;border:1px solid #eee;resize:vertical}
  .small{font-size:14px;color:#6b5d54}
  .logs-list{max-height:220px;overflow:auto;padding:8px 4px}
  .log-item{border-bottom:1px dashed #eee;padding:8px 6px}
  .btn-ghost{background:transparent;border:2px solid var(--peach);padding:8px 10px;border-radius:10px;cursor:pointer}
  .btn-primary{background:var(--peach);color:var(--brown);border:none;padding:10px 14px;border-radius:12px;cursor:pointer}
  .footer{margin:14px 0;text-align:center;color:#8b7f77;font-size:13px}
  .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
  .flex-row{display:flex;gap:8px;align-items:center}
  @media(min-width:720px){header h1{font-size:34px}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>‚ô° Mystery Mood ‚Äî Tracker</h1>
      <div class="small">Tap the button to reveal a mood, log how you feel, and collect sweet quotes ‚ú®</div>
    </header>

    <section class="card">
      <div class="topbar">
        <div>
          <div class="small">No mood logged yet ‚ô°</div>
          <div id="result">‚Äî</div>
        </div>
        <div class="flex-row">
          <button id="mysteryBtn" class="mood-btn">‚ú® Mystery Mood</button>
        </div>
      </div>

      <div class="mood-row" id="moodRow" style="margin-top:14px">
        <!-- mood buttons inserted here -->
      </div>
      <div style="margin-top:12px">
        <label class="small">Add a short note (optional)</label>
        <textarea id="note" placeholder="Write a quick thought, where you are, or a tiny detail..."></textarea>
        <div class="controls">
          <button id="saveLog" class="btn-primary">Save Log</button>
          <button id="viewLogs" class="btn-ghost">View Logs</button>
          <button id="exportCSV" class="btn-ghost">Export CSV</button>
          <button id="clearAll" class="btn-ghost">Clear All Logs</button>
        </div>
      </div>
    </section>

    <section class="card" id="logsCard" style="display:none">
      <h3>Recent Logs</h3>
      <div class="logs-list" id="logsList">
        <!-- logs -->
      </div>
      <div style="text-align:center;margin-top:10px">
        <button id="closeLogs" class="btn-ghost">Close</button>
      </div>
    </section>

    <div class="footer">
      Made with ‚ô° ‚Äî Peachy Kawaii ‚Ä¢ Data stored only on this device. Export anytime.
    </div>
  </div>

<script>
/* ======= Data & config ======= */
const MOODS = [
  {id:'calm', label:'‚òÅÔ∏è Calm', quote:"Take a slow breath ‚Äî you are allowed to rest."},
  {id:'happy', label:'‚òÄÔ∏è Happy', quote:"Keep shining ‚Äî your joy is contagious."},
  {id:'cozy', label:'‚òï Cozy', quote:"Wrap yourself in small comforts today."},
  {id:'excited', label:'‚ú® Excited', quote:"Sparkle onward ‚Äî brilliant things await."},
  {id:'sad', label:'üåßÔ∏è Sad', quote:"It‚Äôs okay to feel low ‚Äî be gentle with you."},
  {id:'anxious', label:'‚ö° Anxious', quote:"Ground your feet. One step at a time."},
  {id:'playful', label:'üêæ Playful', quote:"Go chase a tiny joy ‚Äî giggles count."}
];

const STORAGE_KEY = 'mystery_mood_logs_v1';

/* ======= UI helpers ======= */
function el(id){ return document.getElementById(id); }
function saveLogs(arr){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(arr||[]));
}
function loadLogs(){
  try{ return JSON.parse(localStorage.getItem(STORAGE_KEY))||[] } catch(e){ return [] }
}

/* ======= Render mood buttons ======= */
function renderMoodButtons(){
  const row = el('moodRow'); row.innerHTML='';
  MOODS.forEach(m=>{
    const b = document.createElement('button');
    b.className='mood-small';
    b.textContent = m.label;
    b.onclick = ()=> selectMood(m.id);
    row.appendChild(b);
  });
}

/* ======= Current selection ======= */
let currentMood = null;
function setResultText(text){
  el('result').textContent = text;
}
function selectMood(id){
  const m = MOODS.find(x=>x.id===id);
  currentMood = m;
  setResultText(m.label + " ‚Äî " + m.quote);
}

/* ======= Mystery ======= */
function mysteryMood(){
  const pick = MOODS[Math.floor(Math.random()*MOODS.length)];
  selectMood(pick.id);
}

/* ======= Save log ======= */
function saveCurrentLog(){
  if(!currentMood){
    alert('Please reveal a mood or choose one to save.');
    return;
  }
  const note = el('note').value.trim();
  const entry = {
    id: 'log_' + Date.now(),
    moodId: currentMood.id,
    moodLabel: currentMood.label,
    quote: currentMood.quote,
    note: note,
    time: new Date().toISOString()
  };
  const logs = loadLogs();
  logs.unshift(entry);
  saveLogs(logs);
  el('note').value = '';
  showToast('Saved ‚ô•');
}

/* ======= Logs UI ======= */
function openLogs(){
  const logs = loadLogs();
  const container = el('logsList');
  container.innerHTML = '';
  if(!logs.length){
    container.innerHTML = '<div class="small">No logs yet ‚Äî save your mood to build a history.</div>';
  } else {
    logs.forEach(l=>{
      const d = document.createElement('div');
      d.className='log-item';
      const time = new Date(l.time).toLocaleString();
      d.innerHTML = `<strong>${l.moodLabel}</strong> <div style="font-size:12px;color:#8b7f77">${time}</div>
                     <div style="margin-top:6px;color:#444">${escapeHtml(l.quote)}</div>
                     ${l.note ? `<div style="margin-top:6px;font-size:14px">üìù ${escapeHtml(l.note)}</div>` : ''}
                     <div style="margin-top:8px"><button class="btn-ghost" onclick="deleteLog('${l.id}')">Delete</button></div>`;
      container.appendChild(d);
    });
  }
  el('logsCard').style.display = 'block';
}
function closeLogs(){ el('logsCard').style.display='none' }
function deleteLog(id){
  let logs = loadLogs();
  logs = logs.filter(l=>l.id !== id);
  saveLogs(logs);
  openLogs();
}

/* ======= Export CSV ======= */
function exportCSV(){
  const logs = loadLogs();
  if(!logs.length){ alert('No logs to export'); return; }
  const header = ['time','mood','quote','note'];
  const rows = logs.map(l=>[l.time, l.moodLabel, l.quote, l.note||'']);
  const csv = [header, ...rows].map(r => r.map(v=>`"${(String(v||'')).replace(/"/g,'""')}"`).join(',')).join('\\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'mystery_mood_logs.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

/* ======= Clear all logs ======= */
function clearAll(){
  if(!confirm('Clear all logs? This cannot be undone.')) return;
  saveLogs([]);
  openLogs();
}

/* ======= helpers ======= */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }
function showToast(msg){
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.position='fixed'; t.style.bottom='18px'; t.style.left='50%'; t.style.transform='translateX(-50%)';
  t.style.background='var(--peach)'; t.style.color='var(--brown)'; t.style.padding='8px 12px'; t.style.borderRadius='10px';
  t.style.boxShadow='0 8px 20px rgba(0,0,0,0.12)'; document.body.appendChild(t);
  setTimeout(()=>t.remove(),1400);
}

/* ======= wire up UI ======= */
document.addEventListener('DOMContentLoaded', ()=>{
  renderMoodButtons();
  el('mysteryBtn').addEventListener('click', ()=>{
    mysteryMood();
  });
  el('saveLog').addEventListener('click', saveCurrentLog);
  el('viewLogs').addEventListener('click', openLogs);
  el('closeLogs').addEventListener('click', closeLogs);
  el('exportCSV').addEventListener('click', exportCSV);
  el('clearAll').addEventListener('click', clearAll);

  // If there are saved logs, show last mood
  const logs = loadLogs();
  if(logs.length) {
    const last = logs[0];
    const m = MOODS.find(x=>x.id===last.moodId);
    if(m) selectMood(m.id);
  } else {
    setResultText('No mood logged yet ‚ô°');
  }
});
</script>
</body>
</html>
